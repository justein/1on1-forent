<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>用户登录_万能查</title>
	<meta name="keywords" content=",万能查">
	<meta name="description" itemprop="description" content="_万能查_关注有价值的商业信息">
	<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
<meta name="baidu_union_verify" content="e6967a277abd77a7c56ccede68ce0b97">
<link rel='icon' href="app/resource/images/logox80.jpg" type='image/x-ico'/>
<link href="app/resource/css/reset.css" rel="stylesheet" type="text/css" />
<link href="app/resource/fonts/iconfont.css" rel="stylesheet" type="text/css" />
<link href="app/resource/css/style.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="app/resource/layui/css/layui.css">
<link href="app/resource/css/member.css" rel="stylesheet" type="text/css" />
<script src="app/resource/js/jquery.min.js"></script>
<script src="app/resource/js/jquery.SuperSlide.js"></script>
<script src="app/resource/js/common.js"></script>
<script src="app/resource/js/m.js"></script>
<script src="app/resource/js/clipboard.min.js"></script>
<script src="app/resource/js/modal.js"></script>
<script src="app/resource/layer/layer.js"></script>
	<script src="app/resource/js/bin/jsencrypt.min.js"></script>

	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-9606766828005336",
            enable_page_level_ads: true
        });
	</script>
</head>
<body>
<div class="header">
		
	<div class="topbar">
		<div class="main clearfix">
			<div class="wel-box"><a  href="index.html"   style="cursor:pointer;font-size:12px;color:#888888;">欢迎使用万能查</a></div>

			<div class="wel-link"><a href="user-login.html" class="login-link">登录</a><a href="user-register.html" >注册</a></div>
		</div>
	</div>


	
<!--main-->
<div class="form-wrap clearfix">
	<div class="main-col main-cpi-col">
		<div class="form-lt">
			<div class="lt-header">
				<h3>万能查</h3>
				<p>&nbsp; &nbsp;&nbsp;-关注有价值的商业信息</p>
			</div>
			<div class="lt-pic"><img src="app/resource/images/login-pic.jpg" alt=""></div>
		</div>
	</div>
	<div class="main-col main-form-col">
		<div class="form-inner">
			<div class="form-hor">
				<div class="form-header">
					<h3>万能查</h3>
					<p>综合权威资料信息查询平台</p>
				</div>

<div class="form-group">
    <input type="text" class="form-input" placeholder="请输入账号或手机号" id="username">
    <span class="iconfont icon-iconzh1"></span>
</div>
<div class="form-group">
    <input type="password" class="form-input" placeholder="请输入密码" id="password">
    <span class="iconfont icon-iconfontlock"></span>
</div>
<div class="form-group form-code-group">
    <input type="text" class="form-input" placeholder="请输入图形验证码" id="captcha">
    <span class="iconfont icon-yanzhengma"></span>
    <a href="javascript:;" class="link-code"><img onclick="javascript:re_captcha();"
                                                  src="https://www.00110.cn?m=app&amp;c=member&amp;a=captcha" alt="验证码" title="刷新图片"
                                                  id="c2c98f0de5a04167a9e427d883690ff6" border="0"></a>
</div>
<div class="form-label jus">
    <label class="l-checkbox">
        <input type="checkbox"> 记住密码
    </label>
    <a href="forget.html" class="rg-link">忘记密码></a>
</div>
<input type="hidden" id="public_key" value="-----BEGIN PUBLIC KEY-----
            MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCs/MFnI/uMpyrVOfk4ud4HBmZo
            r7ZXdDNl7TtRTMO4Xzw1fVC/W8wk46vXARIlUQV4jZdEe57MfN4BQe6VzNdafpHp
            0Y26WomvkpHoG6RuVT/bWUl5TLDEaUUQ3jHORgTY8fj4b6hOWys1U+9AOriBH7p7
            Qk48ZaNbUAeQTawkeQIDAQAB-----END PUBLIC KEY-----">
<div class="form-button">
    <button class="btn btn-confirm">登录</button>
</div>
</div>
</div>
</div>
</div>
<script src="app/resource/js/jquery.cookie.js"></script>
<script src="app/resource/js/jquery.base64.js"></script>

<script>
    /**
     * 刷新验证码
     */
    function re_captcha() {
        var url = "https://www.00110.cn?m=app&c=member&a=captcha&captcha=random";
        var random = Math.random();
        url = url.replace("random", random);//使用js自带函数进行变量替换
        document.getElementById('c2c98f0de5a04167a9e427d883690ff6').src = url;
    }
    $(".btn-confirm").click(function () {
        var username = $("#username").val()
        var captcha = $("#captcha").val()
        var password = $("#password").val()

        var type = 1

        var phoneReg = /^1[3-578]\d{9}$/;
        if (phoneReg.test(username)) {
            var mobile = username
            type = 2
        } else {
            if (!new RegExp("^[a-zA-Z0-9_\u4e00-\u9fa5\\s·]+$").test(username)) {
                layer.msg("用户名不能有特殊字符", {icon: 5});
                return false;
            }
            if (/(^\_)|(\__)|(\_+$)/.test(username)) {
                layer.msg("用户名首尾不能出现下划线\'_\'", {icon: 5});
                return false;
            }
            if (/^\d+\d+\d$/.test(username)) {
                layer.msg("用户名不能全为数字", {icon: 5});
                return false;
            }
        }
        if (password.length < 6) {
            layer.msg("密码长度必须大于六位！", {icon: 5});
            return false;
        }

        pub_key = $('#public_key').val();
        var js_encrypt = new JSEncrypt();
        //初始化公钥
        js_encrypt.setPublicKey(pub_key);

        key1 = '{"type": "'+type+'", "username": "'+username+'","captcha": "'+captcha+'"';
        key2 = ',"mobile": "'+mobile+'", "password": "'+password+'"}';
        key1 = js_encrypt.encrypt(key1);
        key2 = js_encrypt.encrypt(key2);

        setCookie();
        $.ajax({
            url: "https://www.00110.cn?m=app&c=member&a=login",//当前ajax请求的地址
            type: 'post',//请求的方式
            async: true,//是否异步  默认为异步
            data: {key1:key1,key2:key2},//当前ajax请求的参数  
            dataType: "json",
            success: function (data) {//发送成功时的代码执行
                if (data.code == 2001) {

                    layer.msg("登陆失败:" + JSON.stringify(data.data));

                    re_captcha();
                    return false;
                }
                if (data.code == 1001) {
                    layer.msg("登陆成功，正在跳转........");
                    var url = "";
                    var uuid = data.data.user.uuid;
                    calculatePersonalityRecommendaion(uuid, 'message', 36);
                    calculatePersonalityRecommendaion(uuid, 'datum', 36);
                    setTimeout(function () {
                        if (url == '') {
                            window.location.href = "personal-homepage.html";
                        } else if (url == "http://www.wannengcha.cn") {
                            window.location.href = "http://www.wannengcha.cn/index.php?m=app&c=index&a=index&token=" + data.data.token
                        } else {
                            url = url.replace(/_/g, "-")
                            window.location.href = "" + url + ".html"
                        }
                    }, 3000);

                } else {
                    layer.msg("登陆失败，请重新尝试登陆");

                }
                re_captcha();
            },
            error: function () {//失败时的代码执行
                layer.msg("登陆失败，请重新尝试登陆");
                re_captcha();
            }

        })
    });

    $.base64.utf8encode = true;
    function setCookie() { //设置cookie    
        var username = $("#username").val(); //获取用户名信息    
        var password = $("#password").val(); //获取登陆密码信息 
        var checked = $("input[type='checkbox']").prop('checked')

        if (checked) { //判断是否选中了“记住密码”复选框    
            $.cookie("username", username);//调用jquery.cookie.js中的方法设置cookie中的用户名    
            $.cookie("password", $.base64('encode', password));//调用jquery.cookie.js中的方法设置cookie中的登陆密码，并使用base64（jquery.base64.js）进行加密    
        } else {
            $.cookie("password", null);
        }
    }
    function getCookie() { //获取cookie    
        var username = $.cookie("username"); //获取cookie中的用户名    
        var password = $.cookie("password"); //获取cookie中的登陆密码    
        if (password) {//密码存在的话把“记住用户名和密码”复选框勾选住    
            $("input[type='checkbox']").attr("checked", "true");
        }
        if (username) {//用户名存在的话把用户名填充到用户名文本框    
            $("#username").val(username);
        }
        if (password) {//密码存在的话把密码填充到密码文本框    
            $("#password").val($.base64('decode', password));
        }
    }
    $(function () {
        getCookie();
    });

    function calculatePersonalityRecommendaion(uuid, type, count)
    {
        $.ajax({
            url: "https://www.00110.cn?m=app&c=Member&a=calculate_personality_recommendation",//当前ajax请求的地址
            type: 'get',//请求的方式
            async: true,//是否异步  默认为异步
            data: {uuid: uuid, type: type, count: count},//当前ajax请求的参数  
            dataType: "json",
            success: function (data) {//发送成功时的代码执行
                console.log(data);
            },
            error:function (data) {
                console.log(data);
            }
        });
    }
</script>

<!--fcooter-->
<div class="footer">
    <div class="main">
        <div class="foot-nav">
            <a href="help-detail-4-10.html">关于万能查</a>
            <a href="help-detail-4-19.html">商务合作</a>
            <a href="help-detail-3-8.html">帮助教程</a>
            <a href="http://www.wannengcha.cn/search-cid-4.html">建议反馈</a>
            <!--<a href="">投诉通道</a>-->
        </div>
        <div class="copyrigt">
            版权所有:Copyright 2018-2020   万能查 渝ICP备18005295号-3号 渝B2-0  渝公网安备号 人杰网络科技有限公司
        </div>
    </div>
</div>
</body>
</html>

